# 代码文档系统模块 - 前端文档

> **返回**: [文档首页](../../README.md)

## 目录

- [1. 概述](#1-概述)
- [2. 页面结构](#2-页面结构)
- [3. 组件结构](#3-组件结构)
- [4. Store 说明](#4-store-说明)
- [5. API 调用规范](#5-api-调用规范)
- [6. 交互流程](#6-交互流程)
- [7. UI 规范](#7-ui-规范)
- [8. 权限控制](#8-权限控制)

---

## 1. 概述

### 1.1 模块边界与目的

代码文档系统（Codepedia）模块负责：

- **代码文档管理**: 代码文档创建和管理
- **需求提交流程**: Wiki任务需求提交
- **投票机制**: 代码文档投票
- **Wiki任务关联**: 与任务系统关联

### 1.2 技术栈

- **框架**: Vue 3 + TypeScript
- **状态管理**: Pinia
- **UI组件**: Ant Design Vue

---

## 2. 页面结构

### 2.1 页面列表

| 页面路径 | 路由名称 | 组件路径 | 说明 |
|---------|---------|---------|------|
| `/codepedia` | `codepedia` | `src/views/codepedia/index.vue` | **代码文档首页** - 代码文档和Wiki任务管理 |

### 2.2 页面布局

#### 2.2.1 代码文档首页布局

**页面路径**: `/codepedia`

**布局结构**:

```
代码文档首页 (/codepedia)
└── codepedia-container (容器)
    └── flex 布局 (左右分栏)
        ├── 左侧面板 (宽度: 640px)
        │   ├── 操作工具栏
        │   │   ├── "创建分类" 按钮
        │   │   ├── "创建功能" 按钮
        │   │   ├── "展开全部" 按钮
        │   │   └── "收起全部" 按钮
        │   └── 树形结构区域
        │       └── CodepediaNode (递归节点)
        │           ├── Category (分类节点)
        │           └── Function (功能节点)
        │               └── WikiTask (任务节点)
        └── 右侧面板 (flex-1)
            ├── 操作工具栏
            │   ├── 标题 (当前选中项)
            │   └── 操作按钮
            │       ├── "创建Wiki任务" 按钮 (功能选中时)
            │       └── "刷新" 按钮
            └── 内容区域
                ├── CategoryDetail (分类详情)
                ├── FunctionDetail (功能详情)
                └── WikiTaskDetail (任务详情)
```

**布局特点**:

1. **左侧面板** (640px 固定宽度):
   - **操作工具栏**:
     - 创建分类：创建新的代码分类
     - 创建功能：在选中分类下创建功能（需先选择分类）
     - 展开全部：展开所有树节点
     - 收起全部：收起所有树节点
   - **树形结构**:
     - 递归展示分类 → 功能 → Wiki任务 的层级结构
     - 支持展开/收起操作
     - 点击节点选中，右侧显示详情

2. **右侧面板** (自适应宽度):
   - **操作工具栏**:
     - 显示当前选中项的标题
     - 根据选中类型显示不同操作按钮
   - **内容区域**:
     - **分类详情**: 显示分类信息，支持编辑和删除
     - **功能详情**: 显示功能信息，支持编辑和删除
     - **任务详情**: 显示Wiki任务信息，支持：
       - 需求提交流程
       - 文档管理
       - 投票功能

**功能说明**:

| 功能区域 | 功能说明 |
|---------|---------|
| **分类管理** | 创建、编辑、删除代码分类，组织代码文档结构 |
| **功能管理** | 在分类下创建功能，管理功能文档 |
| **Wiki任务管理** | 为功能创建Wiki任务，关联任务系统 |
| **需求提交** | Wiki任务的需求提交流程 |
| **文档管理** | 上传、查看、下载功能文档 |
| **投票机制** | 对Wiki任务进行投票选择 |

#### 2.2.2 树形结构说明

**层级关系**:

```
分类 (Category)
└── 功能 (Function)
    └── Wiki任务 (WikiTask)
        ├── 需求提交
        ├── 文档提交
        └── 投票
```

**节点类型**:

- **分类节点**: 顶级节点，用于组织功能
- **功能节点**: 二级节点，属于某个分类
- **任务节点**: 三级节点，属于某个功能，关联任务系统

---

## 3. 组件结构

### 3.1 组件树

```
CodepediaIndex.vue (代码文档首页)
├── CodeDocumentList.vue (文档列表)
├── CodeDocumentEditor.vue (文档编辑器)
└── VotePanel.vue (投票面板)
```

---

## 4. Store 说明

### 4.1 Codepedia Store

**State 定义**:
```typescript
interface CodepediaState {
  codeDocuments: CodeDocument[]
  wikiTasks: WikiTask[]
  votes: Vote[]
}
```

---

## 5. API 调用规范

### 5.1 API 接口列表

| API函数 | 后端接口 | 说明 |
|---------|---------|------|
| `CodepediaCreateOrUpdateCodeDocumentApi` | `POST /codepedia/create_or_update_code_document` | 创建/更新代码文档 |
| `CodepediaCodeDocumentsApi` | `GET /codepedia/code_documents` | 获取代码文档列表 |
| `CodepediaVoteApi` | `POST /codepedia/vote` | 投票 |

---

## 6. 交互流程

### 6.1 创建分类流程

```
1. 用户点击左侧工具栏的"创建分类"按钮
   ↓
2. 打开 CreateCategoryModal（创建分类弹窗）
   ↓
3. 填写分类信息：
   - 分类名称（必填）
   - 父分类（可选，支持层级结构）
   - 分类描述
   ↓
4. 调用 API 创建分类
   ↓
5. 成功后刷新树形结构
```

### 6.2 创建功能流程

```
1. 用户在左侧树中选择一个分类
   ↓
2. 点击左侧工具栏的"创建功能"按钮
   ↓
3. 打开 CreateFunctionModal（创建功能弹窗）
   - 自动关联选中的分类
   ↓
4. 填写功能信息：
   - 功能名称（必填）
   - 功能描述
   - 所属分类（已预填）
   ↓
5. 调用 API 创建功能
   ↓
6. 成功后刷新树形结构，并选中新创建的功能
```

### 6.3 创建Wiki任务流程

```
1. 用户在左侧树中选择一个功能
   ↓
2. 右侧显示功能详情
   ↓
3. 点击右侧工具栏的"创建Wiki任务"按钮
   ↓
4. 打开 CreateWikiTaskModal（创建Wiki任务弹窗）
   - 自动关联选中的功能
   ↓
5. 填写任务信息：
   - 任务标题
   - 任务描述
   - 负责人（可多个，形成任务对）
   ↓
6. 调用 API 创建Wiki任务
   ↓
7. 成功后：
   - 刷新树形结构
   - 在任务系统中创建对应的任务
   - 右侧显示任务详情
```

### 6.4 需求提交流程

```
1. 用户在任务详情中点击"需求提交"按钮
   ↓
2. 打开需求提交表单
   ↓
3. 填写需求信息：
   - 需求描述
   - 附件上传
   ↓
4. 提交需求
   ↓
5. 生成需求包，供开发者下载
```

### 6.5 投票流程

```
1. 用户在会议中查看Wiki任务
   ↓
2. 显示投票按钮（如果有多个任务对）
   ↓
3. 用户选择投票给某个任务
   ↓
4. 调用投票API
   ↓
5. 实时更新投票结果
   ↓
6. 会议结束后，得票多的任务获胜
```

---

## 7. UI 规范

### 7.1 视觉设计

- **页面布局**: 左右分栏布局，左侧固定宽度，右侧自适应
- **树形结构**: 使用递归组件展示层级结构
- **详情展示**: 右侧面板根据选中类型动态显示不同详情组件

### 7.2 组件使用

- **CodepediaNode**: 递归树节点组件，支持分类、功能、任务三种类型
- **CategoryDetail**: 分类详情组件
- **FunctionDetail**: 功能详情组件
- **WikiTaskDetail**: Wiki任务详情组件
- **Modal**: 各种创建和编辑弹窗

### 7.3 交互反馈

- **加载状态**: 使用 `a-spin` 显示加载中
- **空状态**: 显示友好的空状态提示
- **操作反馈**: 使用 `message` 提示操作结果
- **实时更新**: 操作后实时刷新树形结构和详情

---

## 8. 权限控制

- 所有用户可以查看和投票
- 开发者可以创建和编辑文档

---

**文档版本**: v1.0  
**最后更新**: 2025-11-19  
**维护者**: GWEN前端开发团队

